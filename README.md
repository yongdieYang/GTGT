# Multi-Modal Integration of Chemical and Biological Descriptors for Cross-Species Prediction of Fish Acute Toxicity

## 1. Project Overview

This project aims to predict the toxicity or other biological effects of chemical substances on specific species by integrating molecular structure information, genetic information, and taxonomic data.

The model leverages a Graph Neural Network (GNN) to extract molecular features from SMILES formulas. These features are then combined with genetic and taxonomic data through a sophisticated network architecture featuring a cross-attention mechanism for multi-modal feature fusion, ultimately enabling precise predictions.

The project uses Optuna for hyperparameter optimization to find the best model configuration.

Users can make predictions directly through the GTGT platform (https://platform-gtgt.streamlit.app).

<img width="3259" height="2234" alt="GTGT-kaungjiatu-7" src="https://github.com/user-attachments/assets/0a2ec24c-84d7-4265-9689-5ac4ea71de42" />


## 2. Core File Descriptions
-   **`pre_transform.py`**:
    -   **Function**: Responsible for converting chemical SMILES strings into graph-structured data.
    -   **Process**: For each SMILES string, it parses the atoms and bonds within the molecule. Each atom is treated as a node in the graph, and each bond as an edge. It generates a **139-dimensional** feature vector for each atom, encoding various chemical properties.

-   **`CustomDataset.py`**:
    -   **Function**: Defines the custom dataset format for the project.
    -   **Process**: The `CustomDataset` class in this file inherits from PyTorch Geometric's `InMemoryDataset`. It is responsible for loading data from CSV files, including SMILES strings, genetic sequences, taxonomic data, and target values (e.g., LC50). During data loading, it calls the `GenFeatures` class from `pre_transform.py` to process SMILES and generate molecular graphs.

-   **`CMOS.py`**:
    -   **Function**: Defines the core architecture of the entire prediction model.
    -   **Process**: The `GATGENETAXONOMY` class implements the model. It consists of three main components:
        1.  **Molecular Feature Extractor**: Uses a Graph Attention Network (GAT) or other graph convolutional networks to process the molecular graph data generated by `pre_transform.py`.
        2.  **Genetic/Taxonomic Feature Processor**: Uses a 1D Convolutional Neural Network (1D-CNN) or other sequence models to process the input genetic and taxonomic feature vectors.
        3.  **Fusion Module**: Employs a Cross-Attention mechanism to deeply fuse molecular graph features with genetic/taxonomic features, capturing the correlations between different modalities. The final prediction is output through a fully connected layer.

-   **`test-GTGT.py`**:
    -   **Function**: The entry point of the project, used for executing model training, evaluation, and hyperparameter search.
    -   **Process**:
        1.  **Data Loading**: Loads the training, validation, and test datasets using `CustomDataset.py`.
        2.  **Hyperparameter Optimization**: Defines an `objective` function that contains the logic for hyperparameter search using the Optuna library. It automatically tunes parameters like learning rate, batch size, number of layers, and dropout to find the optimal model.
        3.  **Model Training and Evaluation**: Inside the `objective` function, it runs a standard training loop, evaluates the model's performance (e.g., RMSE) on the validation set, and saves the best model and its parameters.
        4.  **Logging**: Uses `wandb` (Weights & Biases) to log and visualize various metrics during the training process.

## 3. Feature Descriptions

### 3.1. Molecular Features

-   **Source**: `pre_transform.py`
-   **Dimension**: 139
-   **Description**: A feature vector is generated for each atom in a molecule, encoding its element type, degree, number of hydrogens, hybridization, chirality, formal charge, radical electrons, and aromaticity.

### 3.2. Genetic and Taxonomic Features

-   **Source**: `CustomDataset.py`
-   **Processing**:
    -   **Genetic Features**: Typically DNA or protein sequences, which are converted into fixed-length numerical vectors during data preprocessing (e.g., via K-mer or other encoding methods).
    -   **Taxonomic Features**: The taxonomic path of a species (e.g., Kingdom, Phylum, Class, Order, Family, Genus, Species) is encoded into a vector.
    -   In `CMOS.py`, these two feature vectors are concatenated and processed through a separate neural network branch (e.g., a 1D-CNN).

## 4. How to Run

### 4.1. Environment Setup

Ensure all required Python libraries are installed, primarily:

-   `torch`
-   `torch_geometric`
-   `rdkit-pypi`
-   `optuna`
-   `pandas`
-   `wandb`

You can install them via `pip`:
```bash
pip install torch torch-geometric rdkit-pypi optuna pandas wandb
```

### 4.2. Running Hyperparameter Search and Training

Simply run the `test-GTGT.py` file to start the Optuna hyperparameter search.

```bash
python test-GTGT.py
```

The script will automatically perform the following steps:
-   Load and preprocess the data.
-   Run `n_trials` (defined in the code) optimization studies.
-   Each trial will train the model with a different set of hyperparameters and evaluate it on the validation set.
-   Logs and results of the search process will be saved in `wandb`-related directories.
-   The best hyperparameter combination and the corresponding model performance will be printed to the console, and the associated model files will be saved.
